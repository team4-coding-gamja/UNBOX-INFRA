# Tempo - Distributed Tracing Backend
# Grafana Tempo는 Zipkin, Jaeger, OpenTelemetry 호환

# 이미지 설정
image:
  repository: grafana/tempo
  tag: 2.3.1
  pullPolicy: IfNotPresent

# 서비스 설정
service:
  type: ClusterIP
  ports:
    # Zipkin 호환 엔드포인트
    zipkin:
      port: 9411
      targetPort: 9411
    # Jaeger 호환 엔드포인트
    jaeger-grpc:
      port: 14250
      targetPort: 14250
    # OpenTelemetry 엔드포인트
    otlp-grpc:
      port: 4317
      targetPort: 4317
    otlp-http:
      port: 4318
      targetPort: 4318

# 리소스 제한 (로컬/Dev 환경용)
resources:
  requests:
    memory: "256Mi"
    cpu: "100m"
  limits:
    memory: "512Mi"
    cpu: "200m"

# Replica 설정
replicaCount: 1

# 스토리지 설정 (로컬 스토리지 사용)
persistence:
  enabled: false  # 로컬 환경에서는 비활성화

# Tempo 설정
config:
  server:
    http_listen_port: 3200
  
  distributor:
    receivers:
      zipkin:  # Zipkin 호환
      jaeger:
        protocols:
          grpc:
      otlp:
        protocols:
          grpc:
          http:
  
  storage:
    trace:
      backend: local
      local:
        path: /tmp/tempo/traces
  
  compactor:
    compaction:
      block_retention: 48h  # 2일간 보관
