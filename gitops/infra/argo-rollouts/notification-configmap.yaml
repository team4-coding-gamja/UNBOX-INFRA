apiVersion: v1
kind: ConfigMap
metadata:
  name: argo-rollouts-notification-configmap
  namespace: argo-rollouts
data:
  service.webhook.discord: |
    url: $discord-webhook-url
    headers:
    - name: Content-Type
      value: application/json
  
  template.rollout-completed: |
    webhook:
      discord:
        method: POST
        body: |
          {
            "embeds": [{
              "title": "âœ… Rollout ë°°í¬ ì™„ë£Œ",
              "description": "**ì„œë¹„ìŠ¤:** `{{.rollout.metadata.name}}`\n**ë„¤ì„ìŠ¤í˜ì´ìŠ¤:** `{{.rollout.metadata.namespace}}`\n**ì´ë¯¸ì§€:** `{{.rollout.spec.template.spec.containers[0].image}}`\n**ì „ëµ:** Canary",
              "color": 3066993,
              "fields": [
                {
                  "name": "Stable Replicas",
                  "value": "{{.rollout.status.replicas}}",
                  "inline": true
                },
                {
                  "name": "Ready Replicas",
                  "value": "{{.rollout.status.readyReplicas}}",
                  "inline": true
                }
              ],
              "timestamp": "{{.rollout.status.conditions[0].lastUpdateTime}}"
            }]
          }
  
  template.rollout-aborted: |
    webhook:
      discord:
        method: POST
        body: |
          {
            "embeds": [{
              "title": "âŒ Rollout ë°°í¬ ì‹¤íŒ¨ (ìë™ ë¡¤ë°±)",
              "description": "**ì„œë¹„ìŠ¤:** `{{.rollout.metadata.name}}`\n**ë„¤ì„ìŠ¤í˜ì´ìŠ¤:** `{{.rollout.metadata.namespace}}`\n**ì´ë¯¸ì§€:** `{{.rollout.spec.template.spec.containers[0].image}}`\n**ì›ì¸:** AnalysisRun ì‹¤íŒ¨",
              "color": 15158332,
              "fields": [
                {
                  "name": "Status",
                  "value": "{{.rollout.status.phase}}",
                  "inline": true
                },
                {
                  "name": "Message",
                  "value": "{{.rollout.status.message}}",
                  "inline": false
                }
              ],
              "timestamp": "{{.rollout.status.conditions[0].lastUpdateTime}}"
            }]
          }
  
  template.rollout-paused: |
    webhook:
      discord:
        method: POST
        body: |
          {
            "embeds": [{
              "title": "â¸ï¸ Rollout ì¼ì‹œ ì¤‘ì§€",
              "description": "**ì„œë¹„ìŠ¤:** `{{.rollout.metadata.name}}`\n**ë„¤ì„ìŠ¤í˜ì´ìŠ¤:** `{{.rollout.metadata.namespace}}`\n**í˜„ì¬ ë‹¨ê³„:** Canary {{.rollout.status.canary.stableRS}}",
              "color": 16776960,
              "timestamp": "{{.rollout.status.conditions[0].lastUpdateTime}}"
            }]
          }
  
  template.rollout-step-completed: |
    webhook:
      discord:
        method: POST
        body: |
          {
            "embeds": [{
              "title": "ğŸ”„ Rollout Canary ë‹¨ê³„ ì™„ë£Œ",
              "description": "**ì„œë¹„ìŠ¤:** `{{.rollout.metadata.name}}`\n**í˜„ì¬ ë‹¨ê³„:** {{.rollout.status.currentStepIndex}}/{{len .rollout.spec.strategy.canary.steps}}\n**Canary ë¹„ìœ¨:** {{.rollout.status.canary.weights.canary}}%",
              "color": 3447003,
              "timestamp": "{{.rollout.status.conditions[0].lastUpdateTime}}"
            }]
          }
  
  trigger.on-rollout-completed: |
    - when: rollout.status.phase == 'Healthy'
      send: [rollout-completed]
  
  trigger.on-rollout-aborted: |
    - when: rollout.status.phase == 'Degraded'
      send: [rollout-aborted]
  
  trigger.on-rollout-paused: |
    - when: rollout.status.phase == 'Paused'
      send: [rollout-paused]
  
  trigger.on-rollout-step-completed: |
    - when: rollout.status.currentStepIndex != null
      send: [rollout-step-completed]
