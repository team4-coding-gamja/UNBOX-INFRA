# AlertManager Discord Webhook ì–´ëŒ‘í„°
# AlertManagerì˜ ì•Œë¦¼ì„ Discord í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•´ì„œ ì „ì†¡
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: alertmanager-discord-config
  namespace: unbox-monitoring
data:
  config.yaml: |
    # Discord Webhook URLì€ Secretì—ì„œ ê°€ì ¸ì˜´
    discord_webhook_url: ${DISCORD_WEBHOOK_URL}
    
    # ì•Œë¦¼ í…œí”Œë¦¿
    templates:
      # CD ê´€ë ¨ ì•Œë¦¼ (ArgoCD Sync, Rollout)
      cd:
        color: 3447003  # íŒŒë€ìƒ‰
        title: "ğŸš€ CD ì´ë²¤íŠ¸"
      
      # ê²½ê³ 
      warning:
        color: 16776960  # ë…¸ë€ìƒ‰
        title: "âš ï¸ ê²½ê³ "
      
      # ì‹¬ê°
      critical:
        color: 15158332  # ë¹¨ê°„ìƒ‰
        title: "ğŸš¨ ì‹¬ê°"
      
      # í•´ê²°ë¨
      resolved:
        color: 3066993  # ì´ˆë¡ìƒ‰
        title: "âœ… í•´ê²°ë¨"

---
apiVersion: v1
kind: Secret
metadata:
  name: discord-webhook
  namespace: unbox-monitoring
type: Opaque
stringData:
  # âš ï¸ ì‹¤ì œ ì‚¬ìš© ì‹œ ì´ ê°’ë“¤ì„ ë³€ê²½í•˜ì„¸ìš”!
  # Dev í™˜ê²½ Discord Webhook URL
  dev-webhook-url: "https://discord.com/api/webhooks/YOUR_DEV_WEBHOOK_ID/YOUR_DEV_WEBHOOK_TOKEN"
  
  # Prod í™˜ê²½ Discord Webhook URL
  prod-webhook-url: "https://discord.com/api/webhooks/YOUR_PROD_WEBHOOK_ID/YOUR_PROD_WEBHOOK_TOKEN"

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: alertmanager-discord
  namespace: unbox-monitoring
  labels:
    app: alertmanager-discord
spec:
  replicas: 1
  selector:
    matchLabels:
      app: alertmanager-discord
  template:
    metadata:
      labels:
        app: alertmanager-discord
    spec:
      containers:
        - name: alertmanager-discord
          # AlertManager Discord Webhook ì–´ëŒ‘í„° ì´ë¯¸ì§€
          image: benjojo/alertmanager-discord:latest
          ports:
            - containerPort: 9094
              name: webhook
          env:
            # í™˜ê²½ ë³€ìˆ˜ë¡œ Discord Webhook URL ì£¼ì…
            - name: DISCORD_WEBHOOK
              valueFrom:
                secretKeyRef:
                  name: discord-webhook
                  # í™˜ê²½ë³„ë¡œ ë‹¤ë¥¸ í‚¤ ì‚¬ìš©
                  # Dev: dev-webhook-url
                  # Prod: prod-webhook-url
                  key: dev-webhook-url  # â† í™˜ê²½ì— ë§ê²Œ ë³€ê²½
          resources:
            requests:
              memory: "64Mi"
              cpu: "50m"
            limits:
              memory: "128Mi"
              cpu: "100m"

---
apiVersion: v1
kind: Service
metadata:
  name: alertmanager-discord
  namespace: unbox-monitoring
  labels:
    app: alertmanager-discord
spec:
  type: ClusterIP
  ports:
    - port: 9094
      targetPort: 9094
      protocol: TCP
      name: webhook
  selector:
    app: alertmanager-discord
