# User Service - Dev Environment
appName: user-service
replicaCount: 1

image:
  repository: 632941626317.dkr.ecr.ap-northeast-2.amazonaws.com/unbox-dev-user-repo
  tag: dev-1f23f3c7490d4e4f5ddc0ecd846ba156c3a6309e
  pullPolicy: Always

targetGroupArn: "arn:aws:elasticloadbalancing:ap-northeast-2:632941626317:targetgroup/user-2026020523301243910000000e/255d23a26f2c60e4"

linkerd:
  enabled: false

service:
  port: 80
  targetPort: 8081

containerPort: 8081

env:
  SERVER_PORT: "8081"
  SERVER_SERVLET_CONTEXT_PATH: "/user"
  
  # JWT Secret (SSM에서 가져옴)
  SPRING_JWT_SECRET:
    valueFrom:
      secretKeyRef:
        name: db-secret
        key: JWT_SECRET
  
  # Database 설정 (SSM에서 엔드포인트 가져옴)
  DB_DRIVER_CLASS_NAME: "org.postgresql.Driver"
  SPRING_JPA_HIBERNATE_DDL_AUTO: "update"
  SPRING_JPA_SHOW_SQL: "false"
  SPRING_DATASOURCE_URL:
    valueFrom:
      secretKeyRef:
        name: db-secret
        key: RDS_ENDPOINT
  SPRING_DATASOURCE_USERNAME: "unbox_admin"
  SPRING_DATASOURCE_PASSWORD:
    valueFrom:
      secretKeyRef:
        name: db-secret
        key: DB_PASSWORD
  
  # Redis 설정 (SSM에서 엔드포인트 가져옴)
  SPRING_DATA_REDIS_HOST:
    valueFrom:
      secretKeyRef:
        name: db-secret
        key: REDIS_ENDPOINT
  SPRING_DATA_REDIS_PORT: "6379"
  SPRING_DATA_REDIS_SSL: "true"
  SPRING_DATA_REDIS_PASSWORD:
    valueFrom:
      secretKeyRef:
        name: db-secret
        key: REDIS_PASSWORD
  
  # Kafka 설정 (SSM에서 엔드포인트 가져옴)
  SPRING_KAFKA_BOOTSTRAP_SERVERS:
    valueFrom:
      secretKeyRef:
        name: db-secret
        key: KAFKA_ENDPOINT
  
  # Zipkin (옵션)
  MANAGEMENT_ZIPKIN_TRACING_ENDPOINT: ""

# 리소스 제한
resources:
  requests:
    memory: "512Mi"
    cpu: "100m"
  limits:
    memory: "1Gi"

# Argo Rollouts 설정
rollout:
  enabled: true
  strategy: "blueGreen"
  
  healthCheck:
    enabled: true
    path: "/user/actuator/health"
    initialDelaySeconds: 30
    periodSeconds: 10
  
  blueGreen:
    autoPromotionEnabled: false
    autoPromotionSeconds: 600
    scaleDownDelaySeconds: 300
