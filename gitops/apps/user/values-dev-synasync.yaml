# User Service - Dev Sync/Async Test Environment
appName: user-service
replicaCount: 1
image:
  repository: 632941626317.dkr.ecr.ap-northeast-2.amazonaws.com/unbox-dev-user-repo
  tag: test-synasync-6a8142a7971775314d26160183a589b711424fe7
  pullPolicy: Always
ingress:
  enabled: false
linkerd:
  enabled: true
service:
  port: 80
  targetPort: 8081
  annotations:
    alb.ingress.kubernetes.io/healthcheck-path: "/user/actuator/health"
containerPort: 8081
env:
  SERVER_PORT: "8081"
  SERVER_SERVLET_CONTEXT_PATH: "/user"
  USER_SERVICE_URL: "http://user-service.unbox-app-synasync"
  PRODUCT_SERVICE_URL: "http://product-service.unbox-app-synasync"
  ORDER_SERVICE_URL: "http://order-service.unbox-app-synasync"
  PAYMENT_SERVICE_URL: "http://payment-service.unbox-app-synasync"
  TRADE_SERVICE_URL: "http://trade-service.unbox-app-synasync"
  SPRING_JWT_SECRET:
    valueFrom:
      secretKeyRef:
        name: db-secret
        key: JWT_SECRET
  DB_DRIVER_CLASS_NAME: "org.postgresql.Driver"
  SPRING_JPA_HIBERNATE_DDL_AUTO: "update"
  SPRING_JPA_SHOW_SQL: "false"
  SPRING_DATASOURCE_URL:
    valueFrom:
      secretKeyRef:
        name: db-secret
        key: RDS_ENDPOINT
  SPRING_DATASOURCE_USERNAME: "unbox_admin"
  SPRING_DATASOURCE_PASSWORD:
    valueFrom:
      secretKeyRef:
        name: db-secret
        key: DB_PASSWORD
  SPRING_DATA_REDIS_HOST:
    valueFrom:
      secretKeyRef:
        name: db-secret
        key: REDIS_ENDPOINT
  SPRING_DATA_REDIS_PORT: "6379"
  SPRING_DATA_REDIS_SSL: "true"
  SPRING_DATA_REDIS_PASSWORD:
    valueFrom:
      secretKeyRef:
        name: db-secret
        key: REDIS_PASSWORD
  SPRING_KAFKA_BOOTSTRAP_SERVERS:
    valueFrom:
      secretKeyRef:
        name: db-secret
        key: KAFKA_ENDPOINT
  MANAGEMENT_TRACING_ENABLED: "true"
  TEMPO_OTLP_ENDPOINT: "http://tempo.monitoring.svc.cluster.local:4318/v1/traces"
  MANAGEMENT_HEALTH_MAIL_ENABLED: "false"
resources:
  requests:
    memory: "512Mi"
    cpu: "100m"
  limits:
    memory: "1Gi"
rollout:
  enabled: true
  strategy: "blueGreen"
  healthCheck:
    enabled: true
    path: "/user/actuator/health"
    periodSeconds: 10
    timeoutSeconds: 5
    startupProbe:
      failureThreshold: 120
      periodSeconds: 10
      timeoutSeconds: 5
  blueGreen:
    autoPromotionEnabled: true
    autoPromotionSeconds: 30
    scaleDownDelaySeconds: 30
