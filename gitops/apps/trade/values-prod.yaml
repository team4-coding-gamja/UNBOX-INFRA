# Trade Service - Prod 환경 오버라이드
replicaCount: 2

image:
  repository: 632941626317.dkr.ecr.ap-northeast-2.amazonaws.com/unbox-dev-trade-repo
  tag: dev-5793a655772035339182e1010e369ec3b920bfe8

# 프로덕션에서는 Linkerd 활성화
linkerd:
  enabled: false

# Prod 환경에서 Rollout 활성화 (Canary - 점진적 배포)
rollout:
  enabled: true
  canary:
    steps:
    - setWeight: 10   # 10% 트래픽
    - pause: {duration: 120s}  # 2분 대기
    - setWeight: 25   # 25% 트래픽
    - pause: {duration: 120s}  # 2분 대기
    - setWeight: 50   # 50% 트래픽
    - pause: {duration: 120s}  # 2분 대기
    - setWeight: 75   # 75% 트래픽
    - pause: {duration: 120s}  # 2분 대기
  analysis:
    enabled: true  # Prod에서 Analysis 활성화
    successRate: 98  # Prod는 더 엄격한 기준 (98%)
    errorRate: 2     # 2% 이하 에러율

# 프로덕션 리소스 제한
resources:
  requests:
    memory: "512Mi"
    cpu: "250m"

# Multi-AZ Pod 분산 설정
affinity:
  enabled: true

  limits:
    memory: "1Gi"
    cpu: "500m"

env:
  SPRING_JWT_SECRET:
    valueFrom:
      secretKeyRef:
        name: db-secret
        key: JWT_SECRET
  SPRING_JPA_HIBERNATE_DDL_AUTO: "update"  # 초기 배포용 update
  
  # Prod RDS
  DB_URL:
    valueFrom:
      secretKeyRef:
        name: db-secret
        key: TRADE_RDS_ENDPOINT
  DB_DRIVER_CLASS_NAME: "org.postgresql.Driver"        
  DB_USERNAME: "unbox_admin"
  DB_PASSWORD:
    valueFrom:
      secretKeyRef:
        name: db-secret
        key: TRADE_DB_PASSWORD
  
  # Prod Kafka
  SPRING_KAFKA_BOOTSTRAP_SERVERS: "prod-kafka.unbox-infra.svc.cluster.local:9092"
  
  # Prod Redis
  SPRING_DATA_REDIS_HOST: "master.unbox-prod-redis.endpoint.apn2.cache.amazonaws.com"
  
  # Prod Zipkin
  MANAGEMENT_ZIPKIN_TRACING_ENDPOINT: "http://zipkin.unbox-infra.svc.cluster.local:9411/api/v2/spans"
