# Trade Service - 공통 기본값
appName: trade-service
replicaCount: 1

image:
  repository: ""  # 환경별로 오버라이드
  tag: latest
  pullPolicy: Always

# 서비스 메시 설정
linkerd:
  enabled: false  # 기본값은 비활성화

service:
  port: 80
  targetPort: 8087

containerPort: 8087

# 공통 환경변수
env:
  SERVER_PORT: "8087"
  DB_DRIVER_CLASS_NAME: "org.postgresql.Driver"
  SPRING_JPA_HIBERNATE_DDL_AUTO: "update"
  SPRING_JPA_SHOW_SQL: "false"
  
  # 기본 연결 설정 (환경별로 오버라이드)
  SPRING_DATASOURCE_URL: ""
  SPRING_DATASOURCE_USERNAME: ""
  SPRING_KAFKA_BOOTSTRAP_SERVERS: ""
  SPRING_DATA_REDIS_HOST: ""
  SPRING_DATA_REDIS_PORT: "6379"
  MANAGEMENT_ZIPKIN_TRACING_ENDPOINT: ""

# 리소스 제한 (기본값)
resources:
  requests:
    memory: "256Mi"
    cpu: "100m"
  limits:
    memory: "512Mi"
    cpu: "250m"

# Argo Rollouts 설정
rollout:
  enabled: false  # 기본적으로 비활성화 (환경별로 활성화)
  strategy: "canary"  # Trade는 Canary 전략 (Tier 2 - 핵심 기능)
  
  # Health Check 설정
  healthCheck:
    enabled: true
    path: "/actuator/health"
    initialDelaySeconds: 30
    periodSeconds: 10
  
  # Canary 전략 설정
  canary:
    steps:
    - setWeight: 10   # 10% 트래픽
    - pause: {duration: 120s}  # 2분 대기
    - setWeight: 25   # 25% 트래픽
    - pause: {duration: 120s}  # 2분 대기
    - setWeight: 50   # 50% 트래픽
    - pause: {duration: 120s}  # 2분 대기
    - setWeight: 75   # 75% 트래픽
    - pause: {duration: 120s}  # 2분 대기
    maxSurge: "25%"
    maxUnavailable: 0
  
  # Analysis 설정 (자동 롤백)
  analysis:
    enabled: false  # 기본적으로 비활성화
    interval: "30s"  # 30초마다 메트릭 체크
    successRate: 95  # 95% 이상 성공률 요구
    errorRate: 5     # 5% 이하 에러율 요구
    avgResponseTime: 1000  # 1초 이하 평균 응답시간
    failureLimit: 3  # 3번 실패 시 롤백
    startingStep: 1  # 두 번째 단계부터 분석 시작
    queryRange: "5m"  # 5분 범위 메트릭
    prometheusAddress: "http://prometheus.unbox-infra.svc.cluster.local:9090"